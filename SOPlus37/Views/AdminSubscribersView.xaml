<UserControl x:Class="SOPlus37.Views.AdminSubscribersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="#FFF7ED"
                BorderBrush="#FED7AA"
                BorderThickness="1"
                CornerRadius="12"
                Padding="14"
                Margin="0,0,0,12">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsLoading}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <TextBlock Text="Загрузка данных..."
                       Foreground="#9A3412"
                       FontSize="13"/>
        </Border>

        <Border Grid.Row="1"
                Background="#FEF2F2"
                BorderBrush="#FECACA"
                BorderThickness="1"
                CornerRadius="12"
                Padding="14"
                Margin="0,0,0,12">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Error}" Value="{x:Null}">
                            <Setter Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Error}" Value="">
                            <Setter Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <TextBlock Text="{Binding Error}"
                       Foreground="#DC2626"
                       FontSize="13"
                       TextWrapping="Wrap"/>
        </Border>

        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Background="White"
                    BorderBrush="#E7ECF5"
                    BorderThickness="1"
                    CornerRadius="16"
                    Padding="16"
                    Margin="0,0,0,14">
                <StackPanel>
                    <TextBlock Text="Статистика"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="#0F172A"
                               Margin="0,0,0,10"/>

                    <WrapPanel ItemWidth="220" ItemHeight="70">
                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Всего абонентов" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding TotalSubscribers}" Foreground="#0F172A" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Активные" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding ActiveCount}" Foreground="#166534" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Заблокированные" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding BlockedCount}" Foreground="#B91C1C" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Физ. лица" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding IndividualsCount}" Foreground="#0F172A" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Юр. лица" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding LegalEntitiesCount}" Foreground="#0F172A" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Всего звонков" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding TotalCalls}" Foreground="#0F172A" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="10" Margin="0,0,10,10">
                            <StackPanel>
                                <TextBlock Text="Всего SMS" Foreground="#64748B" FontSize="12"/>
                                <TextBlock Text="{Binding TotalSms}" Foreground="#0F172A" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Grid.Row="1"
                    Background="White"
                    BorderBrush="#E7ECF5"
                    BorderThickness="1"
                    CornerRadius="16"
                    Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel Margin="0,0,0,12" LastChildFill="False">
                        <TextBlock Text="Список абонентов"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#0F172A"
                                   DockPanel.Dock="Left"/>

                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="Статус:" Foreground="#64748B" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <ComboBox ItemsSource="{Binding StatusFilters}"
                                      SelectedItem="{Binding SelectedStatusFilter}"
                                      DisplayMemberPath="Display"
                                      Width="120"
                                      Margin="0,0,12,0"
                                      Padding="10,6"
                                      Background="#F8FAFC"
                                      BorderBrush="#E2E8F0"
                                      BorderThickness="1"/>

                            <TextBlock Text="Тип:" Foreground="#64748B" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <ComboBox ItemsSource="{Binding ClientTypeFilters}"
                                      SelectedItem="{Binding SelectedClientTypeFilter}"
                                      DisplayMemberPath="Display"
                                      Width="120"
                                      Margin="0,0,12,0"
                                      Padding="10,6"
                                      Background="#F8FAFC"
                                      BorderBrush="#E2E8F0"
                                      BorderThickness="1"/>

                            <Button Content="Показать"
                                    Command="{Binding ShowCommand}"
                                    Height="34"
                                    Padding="16,6"
                                    Background="#0F172A"
                                    Foreground="White"
                                    BorderThickness="0"/>

                            <Button Content="Сформировать PDF"
                                    Command="{Binding GeneratePdfReportCommand}"
                                    Height="34"
                                    Margin="10,0,0,0"
                                    Padding="16,6"
                                    Background="#EF4444"
                                    Foreground="White"
                                    BorderThickness="0"/>
                        </StackPanel>
                    </DockPanel>

                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Subscribers}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              GridLinesVisibility="None"
                              RowHeaderWidth="0"
                              BorderThickness="0"
                              Background="White"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Номер" Binding="{Binding PhoneNumber}" Width="110"/>
                            <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="75"/>
                            <DataGridTextColumn Header="Тип" Binding="{Binding ClientType}" Width="75"/>
                            <DataGridTextColumn Header="ФИО/Орг." Binding="{Binding NameOrOrg}" Width="180"/>
                            <DataGridTextColumn Header="Паспорт/ОГРН" Binding="{Binding Doc}" Width="120"/>
                            <DataGridTextColumn Header="Баланс" Binding="{Binding Balance, StringFormat={}{0:N2} ₽}" Width="80"/>
                            <DataGridTextColumn Header="Тариф" Binding="{Binding TariffName}" Width="180"/>
                            <DataGridTextColumn Header="Услуги" Binding="{Binding ServicesCount}" Width="80"/>
                            <DataGridTextColumn Header="Звонки" Binding="{Binding CallsCount}" Width="80"/>
                            <DataGridTextColumn Header="SMS" Binding="{Binding SmsCount}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
